{{ define "main" }}
  {{ .Scratch.Set "scope" "single" }}
  <article>
    {{/* Hero */}}
    {{ if .Params.showHero | default (site.Params.article.showHero | default false) }}
      {{ $heroStyle := .Params.heroStyle }}
      {{ if not $heroStyle }}{{ $heroStyle = site.Params.article.heroStyle }}{{ end }}
      {{ $heroStyle := print "hero/" $heroStyle ".html" }}
      {{ if templates.Exists ( printf "partials/%s" $heroStyle ) }}
        {{ partial $heroStyle . }}
      {{ else }}
        {{ partial "hero/basic.html" . }}
      {{ end }}
    {{ end }}

    {{/* Header */}}
    <header id="single_header" class="mt-5 max-w-prose">
      {{ if .Params.showBreadcrumbs | default (site.Params.article.showBreadcrumbs | default false) }}
        {{ partial "breadcrumbs.html" . }}
      {{ end }}
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        {{ .Title | emojify }} #
      </h1>
      <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        {{ partial "article-meta/basic.html" (dict "context" . "scope" "single") }}
      </div>
      {{ if not (.Params.showAuthorBottom | default (site.Params.article.showAuthorBottom | default false)) }}
        {{ template "SingleAuthor" . }}
      {{ end }}
    </header>

    {{/* Body */}}
    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      {{ $enableToc := site.Params.article.showTableOfContents | default false }}
      {{ $enableToc = .Params.showTableOfContents | default $enableToc }}
      {{ $showToc := and $enableToc (in .TableOfContents "<ul") }}
      {{ $topClass := cond (hasPrefix site.Params.header.layout "fixed") "lg:top-[140px]" "lg:top-10" }}
      {{ if $showToc }}
        <div class="order-first lg:ml-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs">
          <div class="toc ps-5 print:hidden lg:sticky {{ $topClass }}">
            {{ if $showToc }}
              {{ partial "toc.html" . }}
            {{ end }}
          </div>
        </div>
      {{ end }}

      <div class="min-w-0 min-h-0 max-w-fit">
        {{ partial "series/series.html" . }}
        <div class="article-content" id="article-content">
          {{ .Content }}
        </div>

        {{/* Footer */}}
        {{ template "ArticleFooter" . }}

        {{/* Author bottom */}}
        {{ if .Params.showAuthorBottom | default (site.Params.article.showAuthorBottom | default false) }}
          {{ template "SingleAuthor" . }}
        {{ end }}
      </div>
    </section>
  </article>
{{ end }}

{{/* Author component */}}
{{ define "SingleAuthor" }}
  {{ with .Params.author }}
    {{ $author := index site.Data.authors . }}
    {{ if $author }}
      <div class="mb-10 flex items-center gap-3">
        {{ if $author.image }}
          <img src="{{ $author.image | relURL }}" alt="{{ $author.name }}" class="w-16 h-16 rounded-full object-cover" />
        {{ end }}
        <div>
          <h3 class="text-lg font-semibold text-neutral-800 dark:text-neutral-200">
            {{ $author.name }}
          </h3>
          {{ if $author.bio }}
            <p class="text-sm text-neutral-600 dark:text-neutral-400">
              {{ $author.bio }}
            </p>
          {{ end }}
        </div>
      </div>
    {{ end }}
  {{ end }}
{{ end }}

{{/* Footer component */}}
{{ define "ArticleFooter" }}
  <footer class="mt-12 flex flex-col">
    {{ $tags := .Params.tags }}
    {{ $categories := .Params.categories }}
    {{ if or $tags $categories }}
      <div class="flex flex-wrap gap-2 mb-6">
        {{ range $categories }}
          <a href="{{ (printf "/categories/%s" . | urlize) | relLangURL }}" 
             class="px-3 py-1 text-sm bg-secondary-100 dark:bg-secondary-900 text-secondary-800 dark:text-secondary-200 rounded-full transition-colors hover:bg-secondary-200 dark:hover:bg-secondary-800">
            {{ . }}
          </a>
        {{ end }}
        {{ range $tags }}
          <a href="{{ (printf "/tags/%s" . | urlize) | relLangURL }}" 
             class="px-3 py-1 text-sm bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 rounded-full transition-colors hover:bg-primary-200 dark:hover:bg-primary-800">
            {{ . }}
          </a>
        {{ end }}
      </div>
    {{ end }}

    {{/* Navigation */}}
    {{ if or .Params.showPrevNext | default (site.Params.article.showPrevNext | default false) }}
      <nav class="flex flex-row gap-4 justify-between">
        {{ if .PrevInSection }}
          <a class="flex flex-row items-center gap-2" href="{{ .PrevInSection.RelPermalink }}">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7 7-7-7" />
            </svg>
            <span>{{ .PrevInSection.Title }}</span>
          </a>
        {{ end }}
        {{ if .NextInSection }}
          <a class="flex flex-row items-center gap-2" href="{{ .NextInSection.RelPermalink }}">
            <span>{{ .NextInSection.Title }}</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        {{ end }}
      </nav>
    {{ end }}
  </footer>
{{ end }}